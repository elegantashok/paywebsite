<!DOCTYPE html>
<html>
<head>
  <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
</head>
<body>
  <script>
    const urlParams = new URLSearchParams(window.location.search);
    const amount = urlParams.get('amount');

    var options = {
      "key": "rzp_live_eQbOPFFDxRfzu1", // Razorpay Key ID
      "amount": amount * 100,
      "currency": "INR",
      "name": "My App",
      "description": "Dynamic Payment",
      "handler": function (response){
          alert("Payment Successful: " + response.razorpay_payment_id);

          // Send payment status to Firebase
          fetch("https://alert-aria-372004-default-rtdb.firebaseio.com/CIET/payments.json", { 
              method: "PUT",
              headers: {
                "Content-Type": "application/json"
              },
              body: JSON.stringify({
                status: "success",
                amount: amount,
                payment_id: response.razorpay_payment_id,
                timestamp: new Date().toISOString()
              })
          })
          .then(res => res.json())
          .then(data => {
              console.log("Firebase update success", data);

              // After 1 minute, update status to "waiting"
              setTimeout(() => {
                  fetch("https://alert-aria-372004-default-rtdb.firebaseio.com/CIET/payments/status.json", {
                      method: "PUT",
                      headers: {
                          "Content-Type": "application/json"
                      },
                      body: JSON.stringify("waiting")
                  })
                  .then(res => res.json())
                  .then(data => {
                      console.log("Status updated to waiting", data);
                  })
                  .catch(err => {
                      console.error("Failed to update status to waiting", err);
                  });
              }, 60000);  // 60000 ms = 1 minute
          })
          .catch(err => {
              console.error("Firebase update failed", err);
          });
      },
      "prefill": {
          "name": "PLUNTX",
          "email": "pluntx@example.com",
          "contact": "9866738300"
      },
      "theme": {
          "color": "#F37254"
      }
    };

    var rzp1 = new Razorpay(options);
    rzp1.open();
  </script>
</body>
</html>
